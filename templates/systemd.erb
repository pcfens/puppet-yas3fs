# Managed by puppet/yas3fs
#

[Unit]
Description=S3-backed FUSE filesystem

[Service]
Type=simple
<% if @aws_access_key_id -%>
Environment=AWS_ACCESS_KEY_ID=<%= @aws_access_key_id %> AWS_SECRET_ACCESS_KEY=<%= @aws_secret_access_key %>
<% end -%>
<% cmd_args = '' -%>
<% @options.each do |v| -%>
<% cmd_args = "#{cmd_args} --#{v}" -%>
<% end -%>
# Thank @djtaylor https://github.com/pcfens/puppet-yas3fs/pull/5
# /usr/bin/env yas3fs
<% if @venv_path -%>
  WorkingDirectory=<%= @venv_path %>
  Environment=PATH=<%= @venv_path %>/bin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin
  ExecStart=<%= @venv_path %>/bin/yas3fs -f <%= cmd_args %> <%= @s3_url %> <%= @local_path %>
<% else %>
  Environment=PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin
  ExecStart=/usr/bin/env yas3fs -f <%= cmd_args %> <%= @s3_url %> <%= @local_path %>
<% end %>
ExecStop=/usr/bin/env umount <%= @local_path %>
RestartSec=5
Restart=on-failure
OOMScoreAdjust=-1000

[Install]
WantedBy=multi-user.target
